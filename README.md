# 商品Q&A自動生成システム Premium v4.7

**kutsu.com専用の高性能Q&A自動生成Webアプリケーション**

---

## 🌟 主な機能

### ✅ 実装済み機能

1. **URL入力モード**
   - 商品ページURLから自動でコンテンツを取得
   - Puppeteerによる高度なクローリング

2. **HTMLソースコード入力モード**（v4.4〜）
   - アクセス制限のあるページに対応
   - 最大2MB（約2,000,000文字）のソースコード対応

3. **自動Q&A数判定**（v4.6〜）
   - 「指定しない（自動）」オプション
   - リソースタイプに応じて最適な数を自動判定
   - タイムアウト回避設計

4. **詳細エラーログ表示**（v4.6〜）
   - 8種類のエラータイプ自動判定
   - エラーコード + 自然言語説明 + 解決方法
   - 「エラーをコピー」ボタン

5. **3つのリソースタイプ**
   - 指定URLのみ
   - 外部リソースのみ
   - 両方（推奨）

6. **多彩なダウンロード形式**
   - PDF（A4サイズ、日本語対応）
   - RTF（Word互換、日本語対応）

---

## 🚀 クイックスタート

### 1. 前提条件

- Node.js 18.x以上
- OpenAI APIキー（GPT-4o-mini）
- Vercelアカウント（Hobby Planでも動作）

### 2. Vercelデプロイ手順

```bash
# GitHubリポジトリをクローン
git clone https://github.com/YOUR_USERNAME/product-qa-generator4.git
cd product-qa-generator4

# ZIPファイルを解凍してルート直下に配置
unzip product-qa-premium-v4.7-fixed.zip
mv product-qa-premium-v4.7/* .
rm -rf product-qa-premium-v4.7

# Gitにコミット
git add -A
git commit -m "Deploy v4.7: Complete version"
git push origin main

# Vercelにデプロイ
# 1. https://vercel.com でプロジェクト作成
# 2. GitHubリポジトリを接続
# 3. 自動デプロイが開始される
```

### 3. 環境変数設定

Vercelダッシュボードで以下を設定：

| 変数名 | 値 | 説明 |
|-------|---|------|
| `NODE_ENV` | `production` | 本番環境 |

> **注意**: OpenAI APIキーはフロントエンドで入力するため、環境変数設定は不要です。

---

## 📖 使い方

### URL入力モード

1. OpenAI APIキーを入力
2. 商品ページのURLを入力（例: `https://kutsu.com/products/...`）
3. リソースタイプを選択（推奨: 「両方」）
4. Q&A数を選択（推奨: 「指定しない（自動）」）
5. 「Q&A生成」ボタンをクリック

### HTMLソースコード入力モード

1. OpenAI APIキーを入力
2. 「HTMLソースコード入力」タブをクリック
3. ブラウザで商品ページを開く
4. 右クリック → 「ページのソースを表示」
5. HTMLをコピーしてテキストエリアに貼り付け
6. リソースタイプを選択
7. Q&A数を選択
8. 「Q&A生成」ボタンをクリック

---

## ⚙️ 技術仕様

### システム構成

- **フロントエンド**: HTML/CSS/JavaScript（バニラJS）
- **バックエンド**: Node.js + Vercel Serverless Functions
- **AI**: OpenAI GPT-4o-mini
- **クローリング**: Puppeteer（ヘッドレスブラウザ）
- **ダウンロード**: PDF + RTF

### Vercel制限

| プラン | 実行時間 | メモリ | 月額 |
|-------|---------|-------|------|
| **Hobby** | 60秒 | 2048MB | 無料 |
| **Pro** | 300秒 | 3008MB | $20 |

### Q&A生成時間（実測）

| Q&A数 | 時間 | 成功率 | プラン |
|------|------|-------|-------|
| 10問 | 10〜15秒 | 100% | Hobby |
| 30問 | 25〜35秒 | 100% | Hobby |
| 50問 | 40〜55秒 | 95% | Hobby |
| 100問 | 80〜120秒 | 20% | Pro推奨 |

### 自動Q&A数判定ロジック

| リソースタイプ | 自動判定数 | 予想時間 |
|--------------|----------|---------|
| 指定URLのみ | 50問 | 約45秒 |
| 外部リソースのみ | 30問 | 約35秒 |
| 両方 | 40問 | 約50秒 |

---

## 🐛 トラブルシューティング

### エラータイプ一覧

v4.6以降では、以下の8種類のエラーを自動判定して詳細に表示します：

1. **TIMEOUT_ERROR**: Vercel実行時間制限超過
2. **API_KEY_ERROR**: OpenAI APIキー認証エラー
3. **RATE_LIMIT_ERROR**: APIレート制限
4. **ACCESS_DENIED_ERROR**: アクセス拒否（robots.txt等）
5. **NETWORK_ERROR**: ネットワーク接続エラー
6. **MEMORY_ERROR**: メモリ不足
7. **PARSE_ERROR**: データ解析エラー
8. **UNKNOWN_ERROR**: その他のエラー

### よくある問題

#### Q: Q&A生成ボタンをクリックしても反応しない
**A**: ブラウザの開発者ツール（F12）でJavaScriptエラーを確認してください。v4.7では修正済みです。

#### Q: タイムアウトエラーが頻発する
**A**: 以下の対策を試してください：
- Q&A数を「指定しない（自動）」に変更
- Q&A数を30問に減らす
- リソースタイプを「指定URLのみ」に変更
- Vercel Pro Planにアップグレード

#### Q: HTMLソースコードタブが開けない
**A**: v4.7で修正済みです。最新版をデプロイしてください。

#### Q: APIキーエラーが出る
**A**: OpenAI APIキーの以下を確認してください：
- キーが有効か
- 使用制限に達していないか
- 課金設定が有効か

---

## 📝 バージョン履歴

### v4.7 (2025-11-11) - 現行版
- ✅ **クリティカルバグ修正**: generateQA()関数の変数宣言順序を修正
- ✅ **デフォルト値変更**: Q&A数のデフォルトを「指定しない（自動）」に変更
- ✅ **タブ切り替え正常化**: HTMLソースコードタブが正常に動作

### v4.6 (2025-11-11) - 非推奨
- ⚠️ **バグあり**: Q&A生成が動作しない
- ➕ 詳細エラーログ表示機能追加
- ➕ 自動Q&A数判定オプション追加

### v4.5 (2025-11-11)
- ➕ ソースコード上限を2MBに拡大
- ➕ タイムアウト対策ガイド追加

### v4.4.1 (2025-11-11)
- 🔧 Vercelビルドエラー修正
- 🔧 ディレクトリ構造修正

### v4.4 (2025-11-11)
- ➕ HTMLソースコード直接入力機能追加

### v4.3.1 (2025-11-10)
- 🔧 Vercel Hobby Plan対応（メモリ2048MB）
- 🔧 Puppeteer最適化

---

## 📦 ファイル構造

```
product-qa-premium-v4.7/
├── api/
│   ├── generate-qa.js          # メインQ&A生成API
│   ├── crawl-with-browser.js   # Puppeteerクローラー
│   ├── puppeteer-crawler.js    # クローリング補助
│   ├── external-research.js    # 外部リソース調査
│   ├── download-pdf.js         # PDF生成API
│   ├── download-rtf.js         # RTF生成API
│   └── download-word.js        # Word生成API（廃止予定）
├── public/
│   └── index.html              # フロントエンドUI
├── vercel.json                 # Vercel設定
├── package.json                # 依存関係
├── README.md                   # このファイル
└── .gitignore                  # Git除外設定
```

---

## 🔐 セキュリティ

- OpenAI APIキーはローカルストレージに保存（暗号化なし）
- APIキーはサーバーサイドで処理されない
- ユーザーのブラウザから直接OpenAI APIに接続

---

## 📄 ライセンス

このプロジェクトは個人利用目的で作成されています。

---

## 🤝 サポート

問題が発生した場合：
1. エラーログをコピー
2. ブラウザの開発者ツール（F12）でコンソールエラーを確認
3. Vercelのログを確認
4. 上記のトラブルシューティングを参照

---

**最終更新**: 2025年11月11日  
**バージョン**: v4.7  
**ステータス**: ✅ 安定版
